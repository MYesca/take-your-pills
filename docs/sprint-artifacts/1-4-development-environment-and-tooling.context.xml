<?xml version="1.0" encoding="UTF-8"?>
<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.4</storyId>
    <title>Development Environment and Tooling</title>
    <status>drafted</status>
    <generatedAt>2025-11-19</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-4-development-environment-and-tooling.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>development tooling configured (linting, testing, type checking)</iWant>
    <soThat>code quality is maintained throughout development</soThat>
    <tasks>
      <task id="1" ac="1">
        <title>Configure ESLint</title>
        <subtasks>
          <subtask>Verify ESLint is already installed (Next.js includes it)</subtask>
          <subtask>Create or update ESLint configuration file (`.eslintrc.json` or `eslint.config.mjs`)</subtask>
          <subtask>Configure Next.js ESLint plugin (`@next/eslint-plugin-next`)</subtask>
          <subtask>Enable TypeScript ESLint rules (`@typescript-eslint/eslint-plugin`)</subtask>
          <subtask>Verify ESLint runs without errors: `npm run lint`</subtask>
          <subtask>Add `lint` script to `package.json` if not present</subtask>
        </subtasks>
      </task>
      <task id="2" ac="2">
        <title>Configure Prettier (Optional)</title>
        <subtasks>
          <subtask>Install Prettier: `npm install -D prettier`</subtask>
          <subtask>Create Prettier configuration file (`.prettierrc` or `.prettierrc.json`)</subtask>
          <subtask>Create `.prettierignore` file</subtask>
          <subtask>Add `format` script to `package.json`</subtask>
          <subtask>Configure IDE format on save (document in README or setup guide)</subtask>
        </subtasks>
      </task>
      <task id="3" ac="3">
        <title>Configure Testing with Vitest</title>
        <subtasks>
          <subtask>Verify Vitest is installed (check `package.json`)</subtask>
          <subtask>Create `vitest.config.ts` configuration file</subtask>
          <subtask>Configure Vitest for Next.js App Router</subtask>
          <subtask>Configure @testing-library/react</subtask>
          <subtask>Create test setup file (`vitest.setup.ts` or similar)</subtask>
          <subtask>Create example test file (`__tests__/example.test.ts`)</subtask>
          <subtask>Add `test` script to `package.json`</subtask>
          <subtask>Verify tests run: `npm run test`</subtask>
        </subtasks>
      </task>
      <task id="4" ac="4">
        <title>Configure Type Checking</title>
        <subtasks>
          <subtask>Verify TypeScript is configured (check `tsconfig.json`)</subtask>
          <subtask>Enable TypeScript strict mode in `tsconfig.json`</subtask>
          <subtask>Add `type-check` script to `package.json`: `tsc --noEmit`</subtask>
          <subtask>Verify type checking works: `npm run type-check`</subtask>
          <subtask>Document TypeScript configuration in README</subtask>
        </subtasks>
      </task>
      <task id="5" ac="5">
        <title>Configure Git and Environment Variables</title>
        <subtasks>
          <subtask>Verify `.gitignore` exists and includes: `node_modules/`, `.env.local`, `.next/`, `.turbo/`, `dist/`, `build/`, IDE-specific files</subtask>
          <subtask>Create or update `.env.example` file with all required environment variables</subtask>
          <subtask>Add descriptive comments for each variable in `.env.example`</subtask>
          <subtask>Document environment variable setup in README</subtask>
        </subtasks>
      </task>
      <task id="6" ac="6">
        <title>Verify Development Environment</title>
        <subtasks>
          <subtask>Run `npm run lint` - should pass without errors</subtask>
          <subtask>Run `npm run type-check` - should pass without errors</subtask>
          <subtask>Run `npm run test` - example test should pass</subtask>
          <subtask>Run `npm run dev` - development server should start</subtask>
          <subtask>Document development workflow in README</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">
      <text>Given the project is initialized, when I configure ESLint, then: ESLint configuration file created, Next.js ESLint plugin configured, TypeScript ESLint rules enabled</text>
    </ac>
    <ac id="2">
      <text>When I configure Prettier (optional), then: Prettier configuration file created, Format on save configured in IDE</text>
    </ac>
    <ac id="3">
      <text>When I configure testing, then: Vitest configuration file created, @testing-library/react configured, Test utilities and helpers set up, Example test file created</text>
    </ac>
    <ac id="4">
      <text>When I configure type checking, then: TypeScript strict mode enabled, `npm run type-check` script works</text>
    </ac>
    <ac id="5">
      <text>When I configure Git, then: .gitignore includes node_modules, .env.local, .next, etc., .env.example file created with all required variables</text>
    </ac>
    <ac id="6">
      <text>When all tooling is configured, then the development environment is ready for coding.</text>
    </ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>TakeYourPills - Architecture</title>
        <section>Testing Strategy</section>
        <snippet>Unit Tests: Framework: Vitest (fast, Vite-compatible). Integration Tests: Framework: Vitest + test database. E2E Tests: Framework: Playwright (recommended for Next.js). Test Location: Co-located with source files (`*.test.ts`, `*.spec.ts`) or `__tests__/` directory.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>TakeYourPills - Architecture</title>
        <section>Decision Summary</section>
        <snippet>Language: TypeScript 5.x for all epics. Type safety, better DX, Next.js default. Frontend Framework: Next.js (App Router) 15.x. Full-stack framework, works with shadcn/ui, TypeScript support, API routes included.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>TakeYourPills - Epics and Stories</title>
        <section>Story 1.4: Development Environment and Tooling</section>
        <snippet>User Story: As a developer, I want development tooling configured (linting, testing, type checking), So that code quality is maintained throughout development. Technical Notes: Follow Next.js recommended ESLint configuration, Use Vitest for unit and integration tests, Configure Playwright for E2E tests (future), Ensure all environment variables are documented in .env.example.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/1-4-development-environment-and-tooling.md</path>
        <title>Story 1.4: Development Environment and Tooling</title>
        <section>Dev Notes</section>
        <snippet>Architecture Patterns: Linting: ESLint with Next.js plugin for framework-specific rules. Testing Framework: Vitest for unit and integration tests. Type Checking: TypeScript strict mode for type safety. Code Quality: Maintain consistent code style and catch errors early.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>takeyourpills/eslint.config.mjs</path>
        <kind>configuration</kind>
        <symbol>eslintConfig</symbol>
        <lines>1-19</lines>
        <reason>ESLint configuration file already exists with Next.js plugins configured. Verify and update if needed.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/vitest.config.ts</path>
        <kind>configuration</kind>
        <symbol>vitestConfig</symbol>
        <lines>1-54</lines>
        <reason>Vitest configuration file already exists with React support, jsdom environment, and path aliases. Verify configuration matches requirements.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/vitest.setup.ts</path>
        <kind>test-setup</kind>
        <symbol>vitestSetup</symbol>
        <lines>1-28</lines>
        <reason>Vitest setup file already exists with @testing-library/jest-dom and window.matchMedia mock. Verify setup is complete.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/__tests__/example.test.ts</path>
        <kind>test</kind>
        <symbol>exampleTest</symbol>
        <lines>1-34</lines>
        <reason>Example test file already exists to verify Vitest configuration. Use as reference for test structure.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/tsconfig.json</path>
        <kind>configuration</kind>
        <symbol>tsconfig</symbol>
        <lines>1-34</lines>
        <reason>TypeScript configuration file with strict mode already enabled. Verify strict mode is properly configured.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/package.json</path>
        <kind>manifest</kind>
        <symbol>packageJson</symbol>
        <lines>1-58</lines>
        <reason>Package.json contains scripts (lint, test, type-check) and dependencies. Verify all required scripts are present and dependencies are installed.</reason>
      </artifact>
      <artifact>
        <path>takeyourpills/.gitignore</path>
        <kind>configuration</kind>
        <symbol>gitignore</symbol>
        <lines>1-59</lines>
        <reason>Gitignore file exists with standard Next.js exclusions. Verify it includes all required patterns (node_modules, .env.local, .next, etc.).</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="eslint" version="^9"/>
        <package name="eslint-config-next" version="16.0.3"/>
        <package name="vitest" version="^4.0.12"/>
        <package name="@testing-library/react" version="^16.3.0"/>
        <package name="@testing-library/jest-dom" version="^6.9.1"/>
        <package name="@testing-library/user-event" version="^14.6.1"/>
        <package name="typescript" version="^5"/>
        <package name="@vitejs/plugin-react" version="^4.3.4"/>
        <package name="jsdom" version="^25.0.1"/>
        <package name="@playwright/test" version="^1.56.1"/>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>
      <type>pattern</type>
      <description>ESLint configuration must use Next.js recommended plugins (@next/eslint-plugin-next)</description>
      <source>docs/architecture.md#Testing-Strategy, docs/sprint-artifacts/1-4-development-environment-and-tooling.md#ESLint-Configuration-Details</source>
    </constraint>
    <constraint>
      <type>pattern</type>
      <description>Vitest must be configured for Next.js App Router with jsdom environment for React component testing</description>
      <source>docs/architecture.md#Testing-Strategy, docs/sprint-artifacts/1-4-development-environment-and-tooling.md#Vitest-Configuration-Details</source>
    </constraint>
    <constraint>
      <type>pattern</type>
      <description>TypeScript strict mode must be enabled in tsconfig.json for type safety</description>
      <source>docs/architecture.md#Decision-Summary, docs/sprint-artifacts/1-4-development-environment-and-tooling.md#TypeScript-Configuration</source>
    </constraint>
    <constraint>
      <type>testing</type>
      <description>Test files must be co-located with source files (`*.test.ts`, `*.spec.ts`) or in `__tests__/` directory</description>
      <source>docs/architecture.md#Testing-Strategy</source>
    </constraint>
    <constraint>
      <type>testing</type>
      <description>Unit tests use Vitest for business logic, utilities, CRON calculations. Integration tests use Vitest + test database for API routes and database operations</description>
      <source>docs/architecture.md#Testing-Strategy</source>
    </constraint>
    <constraint>
      <type>file-structure</type>
      <description>Configuration files must be at project root (eslint.config.mjs, vitest.config.ts, tsconfig.json, .gitignore, .env.example)</description>
      <source>docs/architecture.md#Project-Structure</source>
    </constraint>
    <constraint>
      <type>environment</type>
      <description>.env.example must document all required environment variables: DATABASE_URL, NEXT_PUBLIC_AZURE_CLIENT_ID, AZURE_CLIENT_SECRET, AZURE_TENANT_ID, AZURE_REDIRECT_URI</description>
      <source>docs/sprint-artifacts/1-4-development-environment-and-tooling.md#Environment-Variables-Template, docs/sprint-artifacts/1-3-authentication-infrastructure-msal-configuration.md#Senior-Developer-Review</source>
    </constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>package.json scripts</name>
      <kind>npm-scripts</kind>
      <signature>lint, lint:fix, test, test:ui, test:coverage, type-check, dev, build, start</signature>
      <path>takeyourpills/package.json</path>
    </interface>
    <interface>
      <name>ESLint Configuration</name>
      <kind>configuration</kind>
      <signature>eslint.config.mjs exports default config with Next.js plugins (nextVitals, nextTs)</signature>
      <path>takeyourpills/eslint.config.mjs</path>
    </interface>
    <interface>
      <name>Vitest Configuration</name>
      <kind>configuration</kind>
      <signature>vitest.config.ts exports default config with React plugin, jsdom environment, path aliases</signature>
      <path>takeyourpills/vitest.config.ts</path>
    </interface>
    <interface>
      <name>TypeScript Configuration</name>
      <kind>configuration</kind>
      <signature>tsconfig.json with strict: true, paths alias @/*, Next.js plugin</signature>
      <path>takeyourpills/tsconfig.json</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Unit tests use Vitest framework with @testing-library/react for component testing. Tests are co-located with source files (`*.test.ts`, `*.spec.ts`) or in `__tests__/` directory. Integration tests use Vitest + test database for API routes and database operations. Test setup file (vitest.setup.ts) configures @testing-library/jest-dom and mocks window.matchMedia. Coverage configuration uses v8 provider with text, json, and html reporters.
    </standards>
    <locations>
      <location>takeyourpills/__tests__/unit/</location>
      <location>takeyourpills/__tests__/integration/</location>
      <location>**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}</location>
    </locations>
    <ideas>
      <test ac="1">
        <description>Verify ESLint configuration file exists and contains Next.js plugins</description>
        <type>verification</type>
      </test>
      <test ac="1">
        <description>Run `npm run lint` and verify it executes without errors</description>
        <type>integration</type>
      </test>
      <test ac="2">
        <description>If Prettier is configured, verify `.prettierrc` file exists and `format` script works</description>
        <type>verification</type>
      </test>
      <test ac="3">
        <description>Verify Vitest configuration file exists with React plugin and jsdom environment</description>
        <type>verification</type>
      </test>
      <test ac="3">
        <description>Verify vitest.setup.ts exists and configures @testing-library/jest-dom</description>
        <type>verification</type>
      </test>
      <test ac="3">
        <description>Run `npm run test` and verify example test passes</description>
        <type>integration</type>
      </test>
      <test ac="4">
        <description>Verify TypeScript strict mode is enabled in tsconfig.json</description>
        <type>verification</type>
      </test>
      <test ac="4">
        <description>Run `npm run type-check` and verify it executes without errors</description>
        <type>integration</type>
      </test>
      <test ac="5">
        <description>Verify .gitignore includes required patterns (node_modules, .env.local, .next, etc.)</description>
        <type>verification</type>
      </test>
      <test ac="5">
        <description>Verify .env.example file exists with all required environment variables and descriptive comments</description>
        <type>verification</type>
      </test>
      <test ac="6">
        <description>Run all verification commands (lint, type-check, test, dev) and verify development environment is ready</description>
        <type>integration</type>
      </test>
    </ideas>
  </tests>
</story-context>

